<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.book.mapper.book.BookMapper">
    <insert id="save" parameterType="BookVO">
        INSERT INTO `book` VALUES(NULL, #{title}, #{author}, #{publisher}, #{lib}, #{state}, #{target}, #{type}, #{imagePath})
    </insert>

    <resultMap id="findAllBySearch_map" type="BookVO">
        <result property="no" column="no"/>
        <result property="title" column="title"/>
        <result property="author" column="author"/>
    </resultMap>

    <select id="findAllBySearch" resultMap="findAllBySearch_map">
        SELECT * FROM `book`
        WHERE
        <choose>
            <when test="field == 'title'">
                `title` LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="field == 'author'">
                `author` LIKE CONCAT('%', #{keyword}, '%')
            </when>
        </choose>
        ORDER BY
        <choose>
            <when test="sortBy == 'title'">
                `title`
            </when>
            <when test="sortBy == 'author'">
                `author`
            </when>
            <when test="sortBy == 'publisher'">
                `publisher`
            </when>
        </choose>
        <if test="order == 'desc'">
            DESC
        </if>
        LIMIT #{maxResult} OFFSET #{offset}
    </select>

    <select id="findCountBySearch" resultType="int">
        SELECT COUNT(*) FROM `book`
        WHERE
        <choose>
            <when test="field == 'title'">
                `title` LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="field == 'author'">
                `author` LIKE CONCAT('%', #{keyword}, '%')
            </when>
        </choose>
    </select>

    <update id="update">
        UPDATE `book` SET
            `title` = #{title},
            `author` = #{author},
            `publisher` = #{publisher},
            `lib` = #{lib},
            `target` = #{target},
            `type` = #{type},
            `imagePath` = #{imagePath}
        WHERE `no` = #{no}
    </update>

    <delete id="delete" parameterType="int">
        DELETE FROM `book` WHERE `no` = #{no}
    </delete>

    <select id="findByNo" resultType="BookVO">
        SELECT * from `book` WHERE `no` = #{no}
    </select>
</mapper>